<div class="file-explorer h-full flex flex-col bg-white">
  <!-- Header -->
  <div class="header px-6 py-4 border-b border-gray-200">
    <h1 class="text-xl font-semibold text-gray-900">FILE-EXPLORER</h1>

    <!-- Breadcrumb -->
    <nav class="flex mt-2" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-1 text-sm text-gray-500">
        <li *ngFor="let crumb of breadcrumbs; let last = last; let i = index" class="flex items-center">
          <span *ngIf="i > 0" class="mx-1 text-gray-400">›</span>
          <a *ngIf="!last"
             (click)="navigateTo(crumb.path)"
             class="hover:text-gray-700 cursor-pointer hover:underline">
            {{crumb.name}}
          </a>
          <span *ngIf="last" class="text-gray-900 font-medium">{{crumb.name}}</span>
        </li>
      </ol>
    </nav>
  </div>

  <!-- Toolbar -->
  <div class="toolbar px-6 py-3 border-b border-gray-200 flex items-center gap-2 flex-wrap">
    <button mat-flat-button color="primary" (click)="createFolder()" class="!rounded-md">
      <mat-icon class="mr-1">create_new_folder</mat-icon>
      New Folder
    </button>
    <button mat-stroked-button (click)="uploadFiles()" class="!rounded-md">
      <mat-icon class="mr-1">upload</mat-icon>
      Upload File
    </button>
    <button mat-stroked-button (click)="refresh()" class="!rounded-md">
      <mat-icon class="mr-1">refresh</mat-icon>
      Refresh
    </button>

    <div class="flex-1"></div>

    <!-- Bulk actions (shown when items selected) -->
    <ng-container *ngIf="selectedItems.size > 0">
      <button mat-stroked-button color="warn" (click)="deleteSelected()" class="!rounded-md">
        <mat-icon class="mr-1">delete</mat-icon>
        Delete ({{selectedItems.size}})
      </button>
      <button mat-stroked-button (click)="downloadSelected()" class="!rounded-md">
        <mat-icon class="mr-1">download</mat-icon>
        Download ZIP
      </button>
    </ng-container>

  </div>

  <!-- Table (List View) -->
  <div class="flex-1 overflow-auto">
    <table class="w-full">
      <thead class="bg-gray-50 sticky top-0 z-10">
        <tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          <th class="w-10 px-4 py-3 align-middle">
            <div class="flex items-center h-6">
              <mat-checkbox [checked]="allSelected"
                            [indeterminate]="selectedItems.size > 0 && !allSelected"
                            (change)="toggleSelectAll()">
              </mat-checkbox>
            </div>
          </th>
          <th class="px-4 py-3 cursor-pointer hover:bg-gray-100" (click)="sort('name')">
            <div class="flex items-center gap-1">
              Name
              <mat-icon *ngIf="sortColumn === 'name'" class="!text-base">
                {{sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward'}}
              </mat-icon>
            </div>
          </th>
          <th class="px-4 py-3 cursor-pointer hover:bg-gray-100 w-32" (click)="sort('size')">
            <div class="flex items-center gap-1">
              Size
              <mat-icon *ngIf="sortColumn === 'size'" class="!text-base">
                {{sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward'}}
              </mat-icon>
            </div>
          </th>
          <th class="px-4 py-3 w-32">Type</th>
          <th class="px-4 py-3 cursor-pointer hover:bg-gray-100 w-48" (click)="sort('lastModified')">
            <div class="flex items-center gap-1">
              Last Modified
              <mat-icon *ngIf="sortColumn === 'lastModified'" class="!text-base">
                {{sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward'}}
              </mat-icon>
            </div>
          </th>
          <th class="w-16"></th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <!-- Back navigation row -->
        <tr *ngIf="currentPath !== ''"
            class="hover:bg-gray-50 cursor-pointer"
            (dblclick)="navigateUp()">
          <td class="px-4 py-3"></td>
          <td class="px-4 py-3">
            <div class="flex items-center gap-3">
              <mat-icon class="text-gray-400">arrow_back</mat-icon>
              <span class="text-gray-600">..</span>
            </div>
          </td>
          <td class="px-4 py-3 text-gray-500">—</td>
          <td class="px-4 py-3 text-gray-500">—</td>
          <td class="px-4 py-3 text-gray-500">—</td>
          <td class="px-4 py-3"></td>
        </tr>

        <!-- Directories -->
        <tr *ngFor="let dir of currentDirectoryDirs"
            class="hover:bg-gray-50 cursor-pointer group"
            (dblclick)="openFolder(dir)">
          <td class="px-4 py-3 align-middle" (click)="$event.stopPropagation()">
            <div class="flex items-center h-6">
              <mat-checkbox [checked]="isSelected(dir)"
                            (change)="toggleSelection(dir)">
              </mat-checkbox>
            </div>
          </td>
          <td class="px-4 py-3 align-middle">
            <div class="flex items-center gap-3 h-6">
              <mat-icon class="text-yellow-500">folder</mat-icon>
              <span class="text-gray-900">{{dir.name}}</span>
            </div>
          </td>
          <td class="px-4 py-3 align-middle text-gray-500">—</td>
          <td class="px-4 py-3 align-middle text-gray-500">Folder</td>
          <td class="px-4 py-3 align-middle text-gray-500">—</td>
          <td class="px-4 py-3 align-middle" (click)="$event.stopPropagation()">
            <button mat-icon-button
                    [matMenuTriggerFor]="dirMenu"
                    class="opacity-0 group-hover:opacity-100 transition-opacity">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #dirMenu="matMenu">
              <button mat-menu-item (click)="openFolder(dir)">
                <mat-icon>folder_open</mat-icon>
                <span>Open</span>
              </button>
              <button mat-menu-item (click)="renameItem(dir)">
                <mat-icon>edit</mat-icon>
                <span>Rename</span>
              </button>
              <button mat-menu-item (click)="downloadDirectory(dir)">
                <mat-icon>download</mat-icon>
                <span>Download as ZIP</span>
              </button>
              <mat-divider></mat-divider>
              <button mat-menu-item (click)="deleteItem(dir)" class="!text-red-600">
                <mat-icon class="!text-red-600">delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </td>
        </tr>

        <!-- Files -->
        <tr *ngFor="let file of currentDirectoryFiles"
            class="hover:bg-gray-50 group">
          <td class="px-4 py-3 align-middle">
            <div class="flex items-center h-6">
              <mat-checkbox [checked]="isSelected(file)"
                            (change)="toggleSelection(file)">
              </mat-checkbox>
            </div>
          </td>
          <td class="px-4 py-3 align-middle">
            <div class="flex items-center gap-3 h-6">
              <mat-icon class="text-gray-400">{{getFileIcon(file)}}</mat-icon>
              <span class="text-gray-900">{{file.name}}</span>
            </div>
          </td>
          <td class="px-4 py-3 align-middle text-gray-500">{{formatSize(file.size)}}</td>
          <td class="px-4 py-3 align-middle text-gray-500">{{file.extension | uppercase}} File</td>
          <td class="px-4 py-3 align-middle text-gray-500">{{file.lastModified | date:'MMM d, yyyy, h:mm a'}}</td>
          <td class="px-4 py-3 align-middle">
            <button mat-icon-button
                    [matMenuTriggerFor]="fileMenu"
                    class="opacity-0 group-hover:opacity-100 transition-opacity">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #fileMenu="matMenu">
              <button mat-menu-item (click)="downloadFile(file)">
                <mat-icon>download</mat-icon>
                <span>Download</span>
              </button>
              <button mat-menu-item (click)="renameItem(file)">
                <mat-icon>edit</mat-icon>
                <span>Rename</span>
              </button>
              <mat-divider></mat-divider>
              <button mat-menu-item (click)="deleteItem(file)" class="!text-red-600">
                <mat-icon class="!text-red-600">delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </td>
        </tr>

        <!-- Empty state -->
        <tr *ngIf="currentDirectoryDirs.length === 0 && currentDirectoryFiles.length === 0">
          <td colspan="6" class="px-4 py-12 text-center text-gray-500">
            <mat-icon class="!text-5xl text-gray-300 mb-3">folder_open</mat-icon>
            <p>This folder is empty</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Footer -->
  <div class="footer px-6 py-3 border-t border-gray-200 bg-gray-50 text-sm text-gray-500 flex justify-between">
    <span>{{getItemCount()}} items</span>
    <span>{{formatSize(getTotalSize())}} used</span>
  </div>
</div>
